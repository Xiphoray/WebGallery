version: '3.8'

services:
  # 容器名称
  webgallery:    
    container_name: webgallery
    image: webgallery
    # -----------------------------------------------------------
    # 核心配置项 (通过环境变量或 .env 文件传入)
    # -----------------------------------------------------------
    environment:
      # 1. 后端服务监听的端口 (容器内部使用，在 Dockerfile 中默认为 3000)
      BACKEND_PORT: 3573
      # 2. 前端服务监听的端口 (容器内部使用，Vite preview 默认为 5173)
      FRONTEND_PORT: 3574
      # 3. 容器内部的图片根目录 (必须与卷映射的目标路径一致)
      #    该路径已在 Dockerfile 中定义为 /app/data/images
      IMAGE_ROOT: /app/data/images
      # 3. 您的域名，CORS限制
      FRONTEND_ORIGIN: https://domain.com
    
    # -----------------------------------------------------------
    # 端口映射：外部访问的关键
    # -----------------------------------------------------------
    # 使用 ${HOST_FRONTEND_PORT} 和 ${HOST_BACKEND_PORT} 允许动态配置宿主机端口
    ports:
      # 前端访问端口: 宿主机:${HOST_FRONTEND_PORT} -> 容器:5173
      - "3574:3574"
      # 后端 API 端口: 宿主机:${HOST_BACKEND_PORT} -> 容器:3000
      - "3573:3573"

    # -----------------------------------------------------------
    # 卷映射：图片源路径
    # -----------------------------------------------------------
    # 宿主机图片路径 -> 容器内部的 /app/data/images
    # 使用 ${IMAGE_SOURCE_PATH} 变量来指定宿主机的图片路径
    volumes:
      - "/c/这个世界:/app/data/images"
